import type { ObjectId } from 'mongodb'

/**
 * Структура документа MongoDB для коллекции dynamicWBData.
 * Каждый документ представляет один товар (nmId).
 */
export interface DynamicWBDataDocument {
    _id?: ObjectId // ID документа в MongoDB (генерируется автоматически)
    nmId: number // Артикул WB (nmID). Это будет основной бизнес-ключ, должен быть уникальным и индексированным.

    // --- Временные метки для отслеживания свежести данных и управления воркером ---
    lastUpdatedAt: Date // Общее время последнего обновления этого документа в MongoDB.
    cardUpdatedAt?: Date // Оригинальное время обновления карточки из API WB (Этап 1, поле updatedAt из ответа API). Используется для логики курсора на Этапе 1.
    cardDataFetchedAt?: Date // Когда данные карточки от поставщика (Этап 1) были в последний раз загружены.
    siteDataFetchedAt?: Date // Когда данные с сайта WB (Этап 3) были в последний раз загружены.

    // --- Основные данные о товаре (обновляются воркером, приоритет у данных с сайта WB (Этап 3), если доступны) ---
    title?: string // Название товара.
    brand?: string // Бренд товара.
    vendorCode?: string // Артикул поставщика (может отличаться от nmId, из карточки Этап 1).

    // --- Идентификатор поставщика ---
    supplierId?: number // Идентификатор поставщика (legacySupplierId из старой системы или другой ID)

    // --- Физические характеристики и медиа (из карточки, Этап 1) ---
    dimensions?: {
        length: number // Длина в мм
        width: number // Ширина в мм
        height: number // Высота в мм
    }
    photos?: {
        thumbnail: string // URL маленького изображения
        medium: string // URL среднего изображения
        // Можно добавить и другие размеры, если необходимо
    }

    // --- Агрегированная информация с сайта WB (Этап 3) ---
    siteTotalQuantity?: number // Общее количество остатков товара на сайте WB по всем размерам.

    // --- Детализация по размерам ---
    sizes: Array<{
        chrtId: number // ID размера.
        techSize: string // Технический размер.
        wbSize?: string // Размер WB.
        skus?: string[] // Массив баркодов (SKU).
        siteStocks?: Array<{
            warehouseId: number // ID склада WB
            quantity: number // Количество на складе WB
        }>
    }>

    // Технические поля
    createdAt?: Date // Дата создания документа (добавляется автоматически при upsert)
}
